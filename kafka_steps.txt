# add repo
helm repo add strimzi https://strimzi.io/charts

#Create namespace
kubectl create namespace kafka

#Secret
kubectl create secret generic kafka-secret \
  -n kafka \
  --from-env-file=.env

#install kafka operator
helm install my-strimzi-kafka-operator strimzi/strimzi-kafka-operator --version 0.49.1 -n kafka

#levantar kafka cluster y topic
kubectl apply -f k3s/kafka/kafka-cluster.yaml
kubectl apply -f k3s/kafka/kafka-topics.yaml
kubectl apply -f k3s/kafka/kafka-user.yaml


#checar topics
kubectl get kafkatopics -o wide -w -n kafka
kubectl delete KafkaTopic topic-traffic -n kafka

#checar usuarios
kubectl get kafkausers -o wide -w -n kafka
kubectl get kafkausers ml-platform -o yaml -n strimzi-access-operator

#Access Operator
kubectl create -f k3s/kafka/./install/access-operator

#Create Access
kubectl apply -f k3s/kafka/kafka-access.yaml
kubectl get kafkaaccess my-kafka-access -o yaml -n strimzi-access-operator


# Generar y Correr el producer
#Generar imagen
docker build -t k3s-kafka-producer ./producer

#Correr imagen
docker run -d \
  --name producer \
  --env-file .env \
  --cpus="2" \
  --memory="1g" \
  k3s-kafka-producer 

# UI de kafka
kubectl apply -f k3s/kafka/kafka-ui.yaml
